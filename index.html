<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>VNB - ××¢×¨×›×ª × ×™×”×•×œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; margin: 0; background: linear-gradient(to bottom, #0f172a, #1e293b, #0f172a); min-height: 100vh; }
    .tab-btn { padding: 8px 4px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
    .tab-btn.active { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .tab-btn:not(.active) { color: #94a3b8; }
    .card { background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 12px; border: 1px solid #334155; margin-bottom: 8px; }
    .btn { background: #f59e0b; color: #0f172a; font-weight: bold; padding: 12px; border-radius: 8px; border: none; cursor: pointer; width: 100%; }
    .btn-secondary { background: #334155; color: white; }
    .input { width: 100%; background: #334155; color: white; border: none; border-radius: 8px; padding: 12px; margin-bottom: 8px; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 50; padding: 16px; }
    .modal { background: #1e293b; border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #334155; }
    .modal-body { padding: 16px; overflow-y: auto; max-height: calc(90vh - 60px); }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div id="app"></div>
  
  <script>
    // Data
    const VAT = 0.18;
    
    const defaultProducts = [
      { id: 1, name: '×‘×•×¨×’ 35*2.5', boxesPerCarton: 20, pricePerBox: 13, costPerBox: 6.5, initialStock: 68, minStock: 5 },
      { id: 2, name: '×‘×•×¨×’ 35*3.5', boxesPerCarton: 16, pricePerBox: 19, costPerBox: 9.5, initialStock: 26, minStock: 5 },
      { id: 3, name: '×‘×•×¨×’ 4.2*13', boxesPerCarton: 20, pricePerBox: 17, costPerBox: 8.5, initialStock: 42, minStock: 5 },
      { id: 4, name: '×‘×•×¨×’ 4.8*3.5', boxesPerCarton: 16, pricePerBox: 18, costPerBox: 9, initialStock: 72, minStock: 5 },
    ];

    const defaultCustomers = [
      { id: 1, name: '× ×•×¨ ×¨×—××™×', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 2, name: '××©×œ ×—×•××¨×™ ×‘× ×™×™×Ÿ', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 3, name: '×¡×™××Ÿ ×˜×•×‘ ×—×•××¨×™ ×‘× ×™×™×Ÿ', phone: '', address: '××©×“×•×“', paymentTerms: '××–×•××Ÿ' },
      { id: 4, name: '××‘×• ×©×•×©×” ×—×•××¨×™ ×‘× ×™×™×Ÿ', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 5, name: '××‘×™×“×Ÿ ×‘×ª×™ ×¢×¥', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 6, name: '××—×™× ×”×¨×•×©', phone: '', address: '', paymentTerms: '×¦×§' },
      { id: 7, name: '×¢×•×œ× ×”×©×œ×“', phone: '', address: '×ª×œ ××‘×™×‘', paymentTerms: '××–×•××Ÿ' },
      { id: 8, name: '×¤×¨×™××•×¨ ×¨××©×œ×¦', phone: '', address: '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', paymentTerms: '×©×•×˜×£+60' },
      { id: 9, name: '×–× ×• ×§×¨×™×ª ××œ××›×™', phone: '', address: '×§×¨×™×ª ××œ××›×™', paymentTerms: '××–×•××Ÿ' },
      { id: 10, name: '×¢×™×“×Ÿ ×›×—×œ×•×Ÿ', phone: '', address: '×§×¨×™×ª ××œ××›×™', paymentTerms: '××–×•××Ÿ' },
      { id: 11, name: '×‘×¨××©×™×ª ×’×“×¨×”', phone: '', address: '×’×“×¨×”', paymentTerms: '××–×•××Ÿ' },
      { id: 12, name: '××—×™× ×œ×œ×–×¨×™', phone: '', address: '', paymentTerms: '×©×•×˜×£+60' },
      { id: 13, name: '××“×™×¨×™×', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 14, name: '××‘×• ×—×™×™×“×¨', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
      { id: 15, name: '×‘×Ÿ ×™×©×™', phone: '', address: '', paymentTerms: '××–×•××Ÿ' },
    ];

    const defaultSales = [
      { id: 1, date: '2025-12-27', customerId: 1, items: [{productId: 1, cartons: 3, price: 13}, {productId: 2, cartons: 2, price: 19}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 2, price: 9}], paid: 2378.88, status: '×©×•×œ×', notes: '×§×¨×˜×•×Ÿ ××¢×•×¨×‘ ×œ×¤×¨×¡×•×' },
      { id: 2, date: '2025-12-27', customerId: 2, items: [{productId: 1, cartons: 2, price: 6.5}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 1406.56, status: '×©×•×œ×', notes: '' },
      { id: 3, date: '2025-12-28', customerId: 3, items: [{productId: 1, cartons: 2, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 2, price: 17}, {productId: 4, cartons: 5, price: 17.5}], paid: 3426.72, status: '×©×•×œ×', notes: '×•×™×§×˜×•×¨' },
      { id: 4, date: '2025-12-29', customerId: 4, items: [{productId: 1, cartons: 2, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 2, price: 17}, {productId: 4, cartons: 5, price: 17.5}], paid: 1000, status: '×—×œ×§×™', notes: '×™×ª×¨×” 1900' },
      { id: 5, date: '2025-12-30', customerId: 5, items: [{productId: 1, cartons: 1, price: 13}, {productId: 2, cartons: 2, price: 19}, {productId: 3, cartons: 1, price: 17}], paid: 1425.44, status: '×©×•×œ×', notes: '' },
      { id: 6, date: '2026-01-01', customerId: 6, items: [{productId: 1, cartons: 2, price: 13}, {productId: 2, cartons: 2, price: 19}, {productId: 3, cartons: 2, price: 17}, {productId: 4, cartons: 4, price: 18}], paid: 3492.8, status: '×©×•×œ×', notes: '' },
      { id: 7, date: '2026-01-07', customerId: 7, items: [{productId: 2, cartons: 2, price: 19}, {productId: 4, cartons: 36, price: 18}], paid: 12951.68, status: '×©×•×œ×', notes: '' },
      { id: 8, date: '2026-01-08', customerId: 8, items: [{productId: 1, cartons: 1, price: 13}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 0, status: '×××ª×™×Ÿ', dueDate: '2026-03-08', notes: '' },
      { id: 9, date: '2026-01-09', customerId: 9, items: [{productId: 1, cartons: 2, price: 13}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 1354.64, status: '×©×•×œ×', notes: '' },
      { id: 10, date: '2026-01-09', customerId: 10, items: [{productId: 1, cartons: 4, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 2326.96, status: '×©×•×œ×', notes: '' },
      { id: 11, date: '2026-01-09', customerId: 11, items: [{productId: 1, cartons: 2, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 1713.36, status: '×©×•×œ×', notes: '' },
      { id: 12, date: '2026-01-11', customerId: 12, items: [{productId: 1, cartons: 3, price: 13}, {productId: 2, cartons: 2, price: 19}, {productId: 3, cartons: 2, price: 17}, {productId: 4, cartons: 3, price: 18}], paid: 0, status: '×××ª×™×Ÿ', dueDate: '2026-03-11', notes: '' },
      { id: 13, date: '2026-01-13', customerId: 13, items: [{productId: 1, cartons: 1, price: 13}], paid: 306.8, status: '×©×•×œ×', notes: '' },
      { id: 14, date: '2026-01-14', customerId: 14, items: [{productId: 1, cartons: 1, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 1, price: 17}, {productId: 4, cartons: 1, price: 18}], paid: 1406.56, status: '×©×•×œ×', notes: '' },
      { id: 15, date: '2026-01-13', customerId: 15, items: [{productId: 1, cartons: 2, price: 13}, {productId: 2, cartons: 1, price: 19}, {productId: 3, cartons: 2, price: 17}], paid: 1774.72, status: '×©×•×œ×', notes: '' },
    ];

    const defaultLeads = [
      { id: 1, name: '×’×ª ×’×‘×¡', phone: '', status: '×—×“×©', followUp: '' },
      { id: 2, name: '××•×˜×™ ×¤×¨×¥', phone: '', status: '×—×“×©', followUp: '' },
      { id: 3, name: '×—×•××¨×™ ×‘× ×™×™×Ÿ ×¢×™×Ÿ ×§×™× ×™×', phone: '', status: '×—×“×©', followUp: '' },
      { id: 4, name: '×œ×–×¨×™', phone: '', status: '×—×“×©', followUp: '' },
      { id: 5, name: '××¨×– ×—×•××¨×™ ×‘× ×™×™×Ÿ ×¨××©×•×Ÿ', phone: '', status: '×—×“×©', followUp: '' },
      { id: 6, name: '××œ×™××‘ ×—×•××¨×™', phone: '', status: '×—×“×©', followUp: '' },
      { id: 7, name: '××•×× ×•×ª ×”×’×™××•×¨', phone: '', status: '×—×“×©', followUp: '' },
      { id: 8, name: '×‘×ª×™×” ×§×¨×™×ª ××œ××›×™', phone: '', status: '×—×“×©', followUp: '' },
      { id: 9, name: '××“×™×¨× ×—×•××¨×™ ×‘× ×™×™×Ÿ', phone: '', status: '×—×“×©', followUp: '' },
      { id: 10, name: '×¢××™× ×“×‘ ×’×“×¨×”', phone: '', status: '×—×“×©', followUp: '' },
      { id: 11, name: '×¡×œ××•×Ÿ ×’×“×¨×”', phone: '', status: '×—×“×©', followUp: '' },
      { id: 12, name: '× ×ª× ××œ × ×¡ ×¦×™×•× ×”', phone: '', status: '×—×“×©', followUp: '' },
      { id: 13, name: '×©×œ×•××™ ××œ×¢×“', phone: '', status: '×—×“×©', followUp: '' },
      { id: 14, name: '×œ×“××¨×˜', phone: '', status: '×—×“×©', followUp: '' },
      { id: 15, name: '×¡×œ××Ÿ ×¨×”×˜', phone: '', status: '×—×“×©', followUp: '' },
      { id: 16, name: '××¡×‘×™×˜ ×¤×ª×— ×ª×§×•×•×”', phone: '', status: '×—×“×©', followUp: '' },
      { id: 17, name: '××œ×¤×” ×˜×•×¡ ××©×“×•×“', phone: '', status: '×—×“×©', followUp: '' },
      { id: 18, name: '××‘×™ ××“×¨ ×§×¨×™×ª ×’×ª', phone: '', status: '×—×“×©', followUp: '' },
      { id: 19, name: '×—×¡×•× ×” ×œ×•×“', phone: '', status: '×—×“×©', followUp: '' },
      { id: 20, name: '××¦×¤×•×Ÿ ×›×¤×¨ ×¡×‘×', phone: '', status: '×—×“×©', followUp: '' },
      { id: 21, name: '×›×—×œ×•×Ÿ ×§×¨×™×ª ××œ××›×™', phone: '', status: '×—×“×©', followUp: '' },
    ];

    // Load/Save
    function load(key, def) {
      try {
        const d = localStorage.getItem(key);
        return d ? JSON.parse(d) : def;
      } catch(e) { return def; }
    }
    function save(key, data) {
      try { localStorage.setItem(key, JSON.stringify(data)); } catch(e) {}
    }

    // State
    let products = load('vnb4_products', defaultProducts);
    let customers = load('vnb4_customers', defaultCustomers);
    let sales = load('vnb4_sales', defaultSales);
    let leads = load('vnb4_leads', defaultLeads);
    let expenses = load('vnb4_expenses', []);
    let currentTab = 'dashboard';
    let currentModal = null;
    let editingItem = null;

    // Helpers
    function fmt(n) { return 'â‚ª' + (n || 0).toLocaleString('he-IL', {maximumFractionDigits: 0}); }
    
    function calcSaleTotal(sale, withVat = true) {
      let total = 0;
      for (const item of (sale.items || [])) {
        const p = products.find(x => x.id === item.productId);
        if (p) total += item.cartons * p.boxesPerCarton * (item.price || p.pricePerBox);
      }
      return withVat ? total * (1 + VAT) : total;
    }

    function getInventory() {
      return products.map(p => {
        const sold = sales.reduce((sum, s) => {
          const item = (s.items || []).find(i => i.productId === p.id);
          return sum + (item ? item.cartons : 0);
        }, 0);
        const current = (p.initialStock || 0) - sold;
        return { ...p, sold, current, isLow: current <= p.minStock };
      });
    }

    // Render
    function render() {
      const inventory = getInventory();
      const totalSales = sales.reduce((s, x) => s + calcSaleTotal(x, true), 0);
      const totalNoVat = sales.reduce((s, x) => s + calcSaleTotal(x, false), 0);
      const pendingSales = sales.filter(s => s.status !== '×©×•×œ×');
      const totalPending = pendingSales.reduce((s, x) => s + calcSaleTotal(x, true) - (x.paid || 0), 0);
      const lowStock = inventory.filter(p => p.isLow);
      const totalExpenses = expenses.reduce((s, x) => s + (x.amount || 0), 0);

      let content = '';
      
      // Dashboard
      if (currentTab === 'dashboard') {
        content = `
          <div class="card" style="background: rgba(245,158,11,0.2); border-color: rgba(245,158,11,0.3);">
            <div style="color: #f59e0b; font-size: 12px;">×¡×”"×› ××›×™×¨×•×ª (×›×•×œ×œ ××¢"×)</div>
            <div style="color: white; font-size: 24px; font-weight: bold;">${fmt(totalSales)}</div>
            <div style="color: #94a3b8; font-size: 12px;">×œ×¤× ×™ ××¢"×: ${fmt(totalNoVat)}</div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <div class="card" style="background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.3);">
              <div style="color: #ef4444; font-size: 12px;">×××ª×™×Ÿ ×œ×ª×©×œ×•×</div>
              <div style="color: white; font-size: 18px; font-weight: bold;">${fmt(totalPending)}</div>
              <div style="color: #94a3b8; font-size: 11px;">${pendingSales.length} ×¢×¡×§××•×ª</div>
            </div>
            <div class="card" style="background: rgba(168,85,247,0.2); border-color: rgba(168,85,247,0.3);">
              <div style="color: #a855f7; font-size: 12px;">×œ×™×“×™×</div>
              <div style="color: white; font-size: 18px; font-weight: bold;">${leads.length}</div>
            </div>
          </div>

          ${lowStock.length > 0 ? `
            <div class="card" style="background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.3);">
              <div style="color: #ef4444; font-weight: bold; margin-bottom: 8px;">âš ï¸ ××œ××™ × ××•×š</div>
              ${lowStock.map(p => `
                <div style="display: flex; justify-content: space-between; background: rgba(51,65,85,0.3); padding: 8px; border-radius: 6px; margin-bottom: 4px;">
                  <span style="color: white;">${p.name}</span>
                  <span style="color: #ef4444;">${p.current} ×§×¨×˜×•× ×™×</span>
                </div>
              `).join('')}
            </div>
          ` : ''}

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="btn" onclick="openModal('sale')">+ ××›×™×¨×”</button>
            <button class="btn btn-secondary" onclick="openModal('customer')">+ ×œ×§×•×—</button>
          </div>

          <div class="card">
            <div style="color: white; font-weight: bold; margin-bottom: 12px;">××›×™×¨×•×ª ××—×¨×•× ×•×ª</div>
            ${sales.slice(-5).reverse().map(s => {
              const c = customers.find(x => x.id === s.customerId);
              return `
                <div onclick="editSale(${s.id})" style="display: flex; justify-content: space-between; background: rgba(51,65,85,0.3); padding: 8px; border-radius: 6px; margin-bottom: 4px; cursor: pointer;">
                  <div>
                    <div style="color: white; font-size: 14px;">${c ? c.name : '×œ×§×•×—'}</div>
                    <div style="color: #94a3b8; font-size: 11px;">${s.date}</div>
                  </div>
                  <div style="text-align: left;">
                    <div style="color: #94a3b8; font-size: 11px;">${fmt(calcSaleTotal(s, false))}</div>
                    <div style="color: #f59e0b; font-weight: bold;">${fmt(calcSaleTotal(s, true))}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      // Inventory
      else if (currentTab === 'inventory') {
        content = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="color: white; font-size: 18px; font-weight: bold; margin: 0;">××œ××™</h2>
            <button class="btn" style="width: auto; padding: 8px 16px;" onclick="openModal('product')">+ ××•×¦×¨</button>
          </div>
          ${inventory.map(p => `
            <div class="card" onclick="editProduct(${p.id})" style="cursor: pointer; ${p.isLow ? 'border-color: rgba(239,68,68,0.5);' : ''}">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="color: white; font-weight: bold;">${p.name}</span>
                ${p.isLow ? '<span style="color: #ef4444; font-size: 11px;">âš ï¸ × ××•×š</span>' : ''}
              </div>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center; font-size: 12px;">
                <div style="background: rgba(51,65,85,0.5); padding: 8px; border-radius: 6px;">
                  <div style="color: #94a3b8;">×”×ª×—×œ×ª×™</div>
                  <div style="color: white; font-weight: bold;">${p.initialStock}</div>
                </div>
                <div style="background: rgba(51,65,85,0.5); padding: 8px; border-radius: 6px;">
                  <div style="color: #94a3b8;">× ××›×¨</div>
                  <div style="color: #f97316; font-weight: bold;">${p.sold}</div>
                </div>
                <div style="background: ${p.isLow ? 'rgba(239,68,68,0.2)' : 'rgba(51,65,85,0.5)'}; padding: 8px; border-radius: 6px;">
                  <div style="color: #94a3b8;">× ×•×›×—×™</div>
                  <div style="color: ${p.isLow ? '#ef4444' : 'white'}; font-weight: bold;">${p.current}</div>
                </div>
              </div>
            </div>
          `).join('')}
        `;
      }

      // Sales
      else if (currentTab === 'sales') {
        content = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="color: white; font-size: 18px; font-weight: bold; margin: 0;">××›×™×¨×•×ª</h2>
            <button class="btn" style="width: auto; padding: 8px 16px;" onclick="openModal('sale')">+ ××›×™×¨×”</button>
          </div>

          ${pendingSales.length > 0 ? `
            <div class="card" style="background: rgba(249,115,22,0.2); border-color: rgba(249,115,22,0.3);">
              <div style="color: #f97316; font-weight: bold; margin-bottom: 8px;">×××ª×™×Ÿ ×œ×ª×©×œ×•× (${pendingSales.length}) - ${fmt(totalPending)}</div>
              ${pendingSales.map(s => {
                const c = customers.find(x => x.id === s.customerId);
                const total = calcSaleTotal(s, true);
                return `
                  <div onclick="editSale(${s.id})" style="display: flex; justify-content: space-between; background: rgba(51,65,85,0.3); padding: 8px; border-radius: 6px; margin-bottom: 4px; cursor: pointer;">
                    <span style="color: white;">${c ? c.name : '×œ×§×•×—'}</span>
                    <span style="color: #f97316;">${fmt(total - (s.paid || 0))}</span>
                  </div>
                `;
              }).join('')}
            </div>
          ` : ''}

          <div style="max-height: 60vh; overflow-y: auto;">
            ${sales.slice().reverse().map(s => {
              const c = customers.find(x => x.id === s.customerId);
              const totalNoVat = calcSaleTotal(s, false);
              const total = calcSaleTotal(s, true);
              return `
                <div class="card" onclick="editSale(${s.id})" style="cursor: pointer;">
                  <div style="display: flex; justify-content: space-between;">
                    <div>
                      <div style="color: white; font-weight: bold;">${c ? c.name : '×œ×§×•×—'}</div>
                      <div style="color: #94a3b8; font-size: 11px;">${s.date}</div>
                    </div>
                    <div style="text-align: left;">
                      <div style="color: #94a3b8; font-size: 11px;">×œ×¤× ×™ ××¢"×: ${fmt(totalNoVat)}</div>
                      <div style="color: #f59e0b; font-weight: bold;">${fmt(total)}</div>
                      <span style="font-size: 10px; padding: 2px 8px; border-radius: 10px; ${s.status === '×©×•×œ×' ? 'background: rgba(16,185,129,0.2); color: #10b981;' : 'background: rgba(239,68,68,0.2); color: #ef4444;'}">${s.status}</span>
                    </div>
                  </div>
                  ${s.status !== '×©×•×œ×' ? `<div style="color: #ef4444; font-size: 11px; margin-top: 4px;">×™×ª×¨×”: ${fmt(total - (s.paid || 0))}</div>` : ''}
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      // Customers
      else if (currentTab === 'customers') {
        content = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="color: white; font-size: 18px; font-weight: bold; margin: 0;">×œ×§×•×—×•×ª (${customers.length})</h2>
            <button class="btn" style="width: auto; padding: 8px 16px;" onclick="openModal('customer')">+ ×œ×§×•×—</button>
          </div>
          <div style="max-height: 70vh; overflow-y: auto;">
            ${customers.map(c => {
              const customerSales = sales.filter(s => s.customerId === c.id);
              const total = customerSales.reduce((sum, s) => sum + calcSaleTotal(s, true), 0);
              return `
                <div class="card" onclick="editCustomer(${c.id})" style="cursor: pointer;">
                  <div style="display: flex; justify-content: space-between;">
                    <div>
                      <div style="color: white; font-weight: bold;">${c.name}</div>
                      <div style="color: #94a3b8; font-size: 11px;">${c.phone || '-'} â€¢ ${c.address || '-'}</div>
                      <div style="color: #64748b; font-size: 11px;">${customerSales.length} ×”×–×× ×•×ª</div>
                    </div>
                    <div style="color: #f59e0b; font-weight: bold;">${fmt(total)}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      // Leads
      else if (currentTab === 'leads') {
        content = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="color: white; font-size: 18px; font-weight: bold; margin: 0;">×œ×™×“×™× (${leads.length})</h2>
            <button class="btn" style="width: auto; padding: 8px 16px;" onclick="openModal('lead')">+ ×œ×™×“</button>
          </div>
          <div style="max-height: 70vh; overflow-y: auto;">
            ${leads.map(l => `
              <div class="card" onclick="editLead(${l.id})" style="cursor: pointer;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="color: white; font-weight: bold;">${l.name}</div>
                    ${l.phone ? `<div style="color: #94a3b8; font-size: 11px;">${l.phone}</div>` : ''}
                  </div>
                  <span style="font-size: 11px; padding: 4px 8px; border-radius: 10px; background: rgba(59,130,246,0.2); color: #3b82f6;">${l.status}</span>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      }

      // Expenses
      else if (currentTab === 'expenses') {
        content = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="color: white; font-size: 18px; font-weight: bold; margin: 0;">×”×•×¦××•×ª</h2>
            <button class="btn" style="width: auto; padding: 8px 16px;" onclick="openModal('expense')">+ ×”×•×¦××”</button>
          </div>
          <div class="card" style="background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.3);">
            <div style="color: #ef4444; font-size: 12px;">×¡×”"×› ×”×•×¦××•×ª</div>
            <div style="color: white; font-size: 24px; font-weight: bold;">${fmt(totalExpenses)}</div>
          </div>
          ${expenses.length === 0 ? '<div style="color: #64748b; text-align: center; padding: 24px;">××™×Ÿ ×”×•×¦××•×ª</div>' : ''}
          ${expenses.slice().reverse().map(e => `
            <div class="card" onclick="editExpense(${e.id})" style="cursor: pointer;">
              <div style="display: flex; justify-content: space-between;">
                <div>
                  <div style="color: white;">${e.description || e.category}</div>
                  <div style="color: #94a3b8; font-size: 11px;">${e.date} â€¢ ${e.category}</div>
                </div>
                <div style="color: #ef4444; font-weight: bold;">${fmt(e.amount)}</div>
              </div>
            </div>
          `).join('')}
        `;
      }

      // Settings
      else if (currentTab === 'settings') {
        content = `
          <h2 style="color: white; font-size: 18px; font-weight: bold; margin-bottom: 12px;">×”×’×“×¨×•×ª</h2>
          <div class="card">
            <div style="color: #f59e0b; font-weight: bold; margin-bottom: 12px;">×’×™×‘×•×™</div>
            <button class="btn" style="margin-bottom: 8px;" onclick="exportData()">ğŸ“¥ ×”×•×¨×“ ×’×™×‘×•×™</button>
            <label class="btn btn-secondary" style="display: block; text-align: center;">
              ğŸ“¤ ×˜×¢×Ÿ ×’×™×‘×•×™
              <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
            </label>
          </div>
          <div class="card" style="background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.3);">
            <button onclick="resetData()" style="width: 100%; background: #ef4444; color: white; font-weight: bold; padding: 12px; border-radius: 8px; border: none; cursor: pointer;">ğŸ—‘ï¸ ××—×§ ×”×›×œ</button>
          </div>
        `;
      }

      // Build page
      document.getElementById('app').innerHTML = `
        <header style="background: rgba(30,41,59,0.9); position: sticky; top: 0; z-index: 40; border-bottom: 1px solid #334155; padding: 12px 16px;">
          <div style="max-width: 500px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1 style="color: #f59e0b; font-size: 20px; font-weight: bold; margin: 0;">VNB</h1>
              <p style="color: #94a3b8; font-size: 11px; margin: 0;">×’×¨×™× ×‘×¨×’ × ×™×¨×™×</p>
            </div>
            <div style="text-align: left;">
              <div style="color: #f59e0b; font-weight: bold;">${fmt(totalSales)}</div>
              <div style="color: #94a3b8; font-size: 11px;">×›×•×œ×œ ××¢"×</div>
            </div>
          </div>
        </header>

        <main style="max-width: 500px; margin: 0 auto; padding: 16px; padding-bottom: 100px;">
          ${content}
        </main>

        <nav style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(30,41,59,0.95); border-top: 1px solid #334155; padding: 8px;">
          <div style="max-width: 500px; margin: 0 auto; display: flex; justify-content: space-around;">
            <div class="tab-btn ${currentTab === 'dashboard' ? 'active' : ''}" onclick="switchTab('dashboard')">
              <span style="font-size: 20px;">ğŸ </span><span style="font-size: 10px;">×¨××©×™</span>
            </div>
            <div class="tab-btn ${currentTab === 'inventory' ? 'active' : ''}" onclick="switchTab('inventory')">
              <span style="font-size: 20px;">ğŸ“¦</span><span style="font-size: 10px;">××œ××™</span>
            </div>
            <div class="tab-btn ${currentTab === 'sales' ? 'active' : ''}" onclick="switchTab('sales')">
              <span style="font-size: 20px;">ğŸ’°</span><span style="font-size: 10px;">××›×™×¨×•×ª</span>
            </div>
            <div class="tab-btn ${currentTab === 'customers' ? 'active' : ''}" onclick="switchTab('customers')">
              <span style="font-size: 20px;">ğŸ‘¥</span><span style="font-size: 10px;">×œ×§×•×—×•×ª</span>
            </div>
            <div class="tab-btn ${currentTab === 'leads' ? 'active' : ''}" onclick="switchTab('leads')">
              <span style="font-size: 20px;">ğŸ¯</span><span style="font-size: 10px;">×œ×™×“×™×</span>
            </div>
            <div class="tab-btn ${currentTab === 'expenses' ? 'active' : ''}" onclick="switchTab('expenses')">
              <span style="font-size: 20px;">ğŸ’¸</span><span style="font-size: 10px;">×”×•×¦××•×ª</span>
            </div>
            <div class="tab-btn ${currentTab === 'settings' ? 'active' : ''}" onclick="switchTab('settings')">
              <span style="font-size: 20px;">âš™ï¸</span><span style="font-size: 10px;">×”×’×“×¨×•×ª</span>
            </div>
          </div>
        </nav>

        ${currentModal ? renderModal() : ''}
      `;
    }

    function renderModal() {
      let title = '';
      let body = '';

      if (currentModal === 'sale') {
        title = editingItem ? '×¢×¨×™×›×ª ××›×™×¨×”' : '××›×™×¨×” ×—×“×©×”';
        const sale = editingItem || { date: new Date().toISOString().split('T')[0], customerId: '', items: [], paid: 0, status: '×××ª×™×Ÿ', notes: '' };
        body = `
          <input type="date" class="input" id="saleDate" value="${sale.date}">
          <select class="input" id="saleCustomer">
            <option value="">×‘×—×¨ ×œ×§×•×—</option>
            ${customers.map(c => `<option value="${c.id}" ${sale.customerId == c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
          </select>
          <div style="margin-bottom: 8px;">
            <input type="text" class="input" id="newCustomerName" placeholder="××• ×”×•×¡×£ ×œ×§×•×— ×—×“×©..." style="margin-bottom: 4px;">
            <button class="btn btn-secondary" style="font-size: 12px; padding: 8px;" onclick="addNewCustomerInSale()">+ ×”×•×¡×£ ×œ×§×•×—</button>
          </div>
          <div style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">××•×¦×¨×™×:</div>
          ${products.map(p => {
            const item = (sale.items || []).find(i => i.productId === p.id) || { cartons: 0, price: p.pricePerBox };
            return `
              <div style="background: rgba(51,65,85,0.5); padding: 8px; border-radius: 8px; margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                  <span style="color: white; font-size: 14px;">${p.name}</span>
                  <input type="number" min="0" class="input" style="width: 80px; margin: 0; text-align: center;" id="cartons_${p.id}" value="${item.cartons || ''}" placeholder="×§×¨×˜×•× ×™×">
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span style="color: #94a3b8; font-size: 11px;">××—×™×¨/×§×•×¤×¡×:</span>
                  <input type="number" step="0.5" class="input" style="width: 70px; margin: 0; text-align: center; font-size: 12px;" id="price_${p.id}" value="${item.price || p.pricePerBox}">
                </div>
              </div>
            `;
          }).join('')}
          <input type="number" class="input" id="salePaid" value="${sale.paid || ''}" placeholder="×¡×›×•× ×©×©×•×œ×">
          <select class="input" id="saleStatus">
            <option value="×××ª×™×Ÿ" ${sale.status === '×××ª×™×Ÿ' ? 'selected' : ''}>×××ª×™×Ÿ</option>
            <option value="×—×œ×§×™" ${sale.status === '×—×œ×§×™' ? 'selected' : ''}>×—×œ×§×™</option>
            <option value="×©×•×œ×" ${sale.status === '×©×•×œ×' ? 'selected' : ''}>×©×•×œ×</option>
          </select>
          <input type="text" class="input" id="saleNotes" value="${sale.notes || ''}" placeholder="×”×¢×¨×•×ª">
          <button class="btn" onclick="saveSale()">×©××•×¨</button>
          ${editingItem ? '<button class="btn btn-secondary" style="margin-top: 8px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteSale()">××—×§</button>' : ''}
        `;
      }

      else if (currentModal === 'customer') {
        title = editingItem ? '×¢×¨×™×›×ª ×œ×§×•×—' : '×œ×§×•×— ×—×“×©';
        const c = editingItem || { name: '', phone: '', address: '', paymentTerms: '××–×•××Ÿ' };
        body = `
          <input type="text" class="input" id="custName" value="${c.name}" placeholder="×©× ×”×¢×¡×§">
          <input type="text" class="input" id="custPhone" value="${c.phone || ''}" placeholder="×˜×œ×¤×•×Ÿ">
          <input type="text" class="input" id="custAddress" value="${c.address || ''}" placeholder="×›×ª×•×‘×ª">
          <select class="input" id="custPayment">
            <option value="××–×•××Ÿ" ${c.paymentTerms === '××–×•××Ÿ' ? 'selected' : ''}>××–×•××Ÿ</option>
            <option value="×©×•×˜×£+30" ${c.paymentTerms === '×©×•×˜×£+30' ? 'selected' : ''}>×©×•×˜×£+30</option>
            <option value="×©×•×˜×£+60" ${c.paymentTerms === '×©×•×˜×£+60' ? 'selected' : ''}>×©×•×˜×£+60</option>
            <option value="×¦×§" ${c.paymentTerms === '×¦×§' ? 'selected' : ''}>×¦'×§</option>
          </select>
          <button class="btn" onclick="saveCustomer()">×©××•×¨</button>
          ${editingItem ? '<button class="btn btn-secondary" style="margin-top: 8px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteCustomer()">××—×§</button>' : ''}
        `;
      }

      else if (currentModal === 'lead') {
        title = editingItem ? '×¢×¨×™×›×ª ×œ×™×“' : '×œ×™×“ ×—×“×©';
        const l = editingItem || { name: '', phone: '', status: '×—×“×©', followUp: '' };
        body = `
          <input type="text" class="input" id="leadName" value="${l.name}" placeholder="×©× ×”×¢×¡×§">
          <input type="text" class="input" id="leadPhone" value="${l.phone || ''}" placeholder="×˜×œ×¤×•×Ÿ">
          <select class="input" id="leadStatus">
            <option value="×—×“×©" ${l.status === '×—×“×©' ? 'selected' : ''}>×—×“×©</option>
            <option value="×¤× ×™×™×” ×¨××©×•× ×”" ${l.status === '×¤× ×™×™×” ×¨××©×•× ×”' ? 'selected' : ''}>×¤× ×™×™×” ×¨××©×•× ×”</option>
            <option value="×¤×’×™×©×”" ${l.status === '×¤×’×™×©×”' ? 'selected' : ''}>×¤×’×™×©×”</option>
            <option value="×”×¦×¢×ª ××—×™×¨" ${l.status === '×”×¦×¢×ª ××—×™×¨' ? 'selected' : ''}>×”×¦×¢×ª ××—×™×¨</option>
          </select>
          <input type="date" class="input" id="leadFollowUp" value="${l.followUp || ''}" placeholder="×ª××¨×™×š ×¤×•×œ×•××¤">
          <button class="btn" onclick="saveLead()">×©××•×¨</button>
          ${editingItem ? `
            <button class="btn" style="margin-top: 8px; background: #10b981;" onclick="convertToCustomer()">ğŸ‰ ×”×¤×•×š ×œ×œ×§×•×—</button>
            <button class="btn btn-secondary" style="margin-top: 8px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteLead()">××—×§</button>
          ` : ''}
        `;
      }

      else if (currentModal === 'expense') {
        title = editingItem ? '×¢×¨×™×›×ª ×”×•×¦××”' : '×”×•×¦××” ×—×“×©×”';
        const e = editingItem || { date: new Date().toISOString().split('T')[0], category: '×“×œ×§', amount: 0, description: '' };
        body = `
          <input type="date" class="input" id="expDate" value="${e.date}">
          <select class="input" id="expCategory">
            <option value="×“×œ×§" ${e.category === '×“×œ×§' ? 'selected' : ''}>×“×œ×§</option>
            <option value="×”×•×‘×œ×•×ª" ${e.category === '×”×•×‘×œ×•×ª' ? 'selected' : ''}>×”×•×‘×œ×•×ª</option>
            <option value="××—×¡× ×”" ${e.category === '××—×¡× ×”' ? 'selected' : ''}>××—×¡× ×”</option>
            <option value="××›×¡" ${e.category === '××›×¡' ? 'selected' : ''}>××›×¡</option>
            <option value="××—×¨" ${e.category === '××—×¨' ? 'selected' : ''}>××—×¨</option>
          </select>
          <input type="number" class="input" id="expAmount" value="${e.amount || ''}" placeholder="×¡×›×•×">
          <input type="text" class="input" id="expDesc" value="${e.description || ''}" placeholder="×ª×™××•×¨">
          <button class="btn" onclick="saveExpense()">×©××•×¨</button>
          ${editingItem ? '<button class="btn btn-secondary" style="margin-top: 8px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteExpense()">××—×§</button>' : ''}
        `;
      }

      else if (currentModal === 'product') {
        title = editingItem ? '×¢×¨×™×›×ª ××•×¦×¨' : '××•×¦×¨ ×—×“×©';
        const p = editingItem || { name: '', boxesPerCarton: 20, pricePerBox: 0, costPerBox: 0, initialStock: 0, minStock: 5 };
        body = `
          <input type="text" class="input" id="prodName" value="${p.name}" placeholder="×©× ×”××•×¦×¨">
          <input type="number" class="input" id="prodBoxes" value="${p.boxesPerCarton}" placeholder="×§×•×¤×¡××•×ª ×‘×§×¨×˜×•×Ÿ">
          <input type="number" step="0.5" class="input" id="prodPrice" value="${p.pricePerBox}" placeholder="××—×™×¨ ×œ×§×•×¤×¡×">
          <input type="number" step="0.5" class="input" id="prodCost" value="${p.costPerBox}" placeholder="×¢×œ×•×ª ×œ×§×•×¤×¡×">
          <input type="number" class="input" id="prodStock" value="${p.initialStock}" placeholder="××œ××™ ×”×ª×—×œ×ª×™">
          <input type="number" class="input" id="prodMin" value="${p.minStock}" placeholder="××™× ×™××•× ×œ×”×ª×¨××”">
          <button class="btn" onclick="saveProduct()">×©××•×¨</button>
          ${editingItem ? '<button class="btn btn-secondary" style="margin-top: 8px; background: rgba(239,68,68,0.2); color: #ef4444;" onclick="deleteProduct()">××—×§</button>' : ''}
        `;
      }

      return `
        <div class="modal-overlay" onclick="closeModal()">
          <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
              <h3 style="color: #f59e0b; font-size: 18px; font-weight: bold; margin: 0;">${title}</h3>
              <button onclick="closeModal()" style="background: none; border: none; color: #94a3b8; font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            <div class="modal-body">${body}</div>
          </div>
        </div>
      `;
    }

    // Actions
    function switchTab(tab) { currentTab = tab; render(); }
    function openModal(type) { currentModal = type; editingItem = null; render(); }
    function closeModal() { currentModal = null; editingItem = null; render(); }

    function editSale(id) { editingItem = sales.find(s => s.id === id); currentModal = 'sale'; render(); }
    function editCustomer(id) { editingItem = customers.find(c => c.id === id); currentModal = 'customer'; render(); }
    function editLead(id) { editingItem = leads.find(l => l.id === id); currentModal = 'lead'; render(); }
    function editExpense(id) { editingItem = expenses.find(e => e.id === id); currentModal = 'expense'; render(); }
    function editProduct(id) { editingItem = products.find(p => p.id === id); currentModal = 'product'; render(); }

    function addNewCustomerInSale() {
      const name = document.getElementById('newCustomerName').value.trim();
      if (!name) return;
      const id = Math.max(0, ...customers.map(c => c.id)) + 1;
      customers.push({ id, name, phone: '', address: '', paymentTerms: '××–×•××Ÿ' });
      save('vnb4_customers', customers);
      document.getElementById('saleCustomer').innerHTML += `<option value="${id}" selected>${name}</option>`;
      document.getElementById('saleCustomer').value = id;
      document.getElementById('newCustomerName').value = '';
    }

    function saveSale() {
      const customerId = parseInt(document.getElementById('saleCustomer').value);
      if (!customerId) return alert('×‘×—×¨ ×œ×§×•×—');
      
      const items = [];
      for (const p of products) {
        const cartons = parseInt(document.getElementById('cartons_' + p.id).value) || 0;
        const price = parseFloat(document.getElementById('price_' + p.id).value) || p.pricePerBox;
        if (cartons > 0) items.push({ productId: p.id, cartons, price });
      }
      if (items.length === 0) return alert('×”×•×¡×£ ××•×¦×¨×™×');

      const sale = {
        id: editingItem ? editingItem.id : Math.max(0, ...sales.map(s => s.id)) + 1,
        date: document.getElementById('saleDate').value,
        customerId,
        items,
        paid: parseFloat(document.getElementById('salePaid').value) || 0,
        status: document.getElementById('saleStatus').value,
        notes: document.getElementById('saleNotes').value
      };

      if (editingItem) {
        const idx = sales.findIndex(s => s.id === editingItem.id);
        sales[idx] = sale;
      } else {
        sales.push(sale);
      }
      save('vnb4_sales', sales);
      closeModal();
    }

    function deleteSale() {
      if (!confirm('×œ××—×•×§?')) return;
      sales = sales.filter(s => s.id !== editingItem.id);
      save('vnb4_sales', sales);
      closeModal();
    }

    function saveCustomer() {
      const name = document.getElementById('custName').value.trim();
      if (!name) return alert('×”×›× ×¡ ×©×');
      
      const c = {
        id: editingItem ? editingItem.id : Math.max(0, ...customers.map(x => x.id)) + 1,
        name,
        phone: document.getElementById('custPhone').value,
        address: document.getElementById('custAddress').value,
        paymentTerms: document.getElementById('custPayment').value
      };

      if (editingItem) {
        const idx = customers.findIndex(x => x.id === editingItem.id);
        customers[idx] = c;
      } else {
        customers.push(c);
      }
      save('vnb4_customers', customers);
      closeModal();
    }

    function deleteCustomer() {
      if (!confirm('×œ××—×•×§?')) return;
      customers = customers.filter(c => c.id !== editingItem.id);
      save('vnb4_customers', customers);
      closeModal();
    }

    function saveLead() {
      const name = document.getElementById('leadName').value.trim();
      if (!name) return alert('×”×›× ×¡ ×©×');
      
      const l = {
        id: editingItem ? editingItem.id : Math.max(0, ...leads.map(x => x.id)) + 1,
        name,
        phone: document.getElementById('leadPhone').value,
        status: document.getElementById('leadStatus').value,
        followUp: document.getElementById('leadFollowUp').value
      };

      if (editingItem) {
        const idx = leads.findIndex(x => x.id === editingItem.id);
        leads[idx] = l;
      } else {
        leads.push(l);
      }
      save('vnb4_leads', leads);
      closeModal();
    }

    function deleteLead() {
      if (!confirm('×œ××—×•×§?')) return;
      leads = leads.filter(l => l.id !== editingItem.id);
      save('vnb4_leads', leads);
      closeModal();
    }

    function convertToCustomer() {
      const l = editingItem;
      const id = Math.max(0, ...customers.map(c => c.id)) + 1;
      customers.push({ id, name: l.name, phone: l.phone, address: '', paymentTerms: '××–×•××Ÿ' });
      leads = leads.filter(x => x.id !== l.id);
      save('vnb4_customers', customers);
      save('vnb4_leads', leads);
      closeModal();
      alert('×”×œ×™×“ ×”×¤×š ×œ×œ×§×•×—!');
    }

    function saveExpense() {
      const amount = parseFloat(document.getElementById('expAmount').value);
      if (!amount) return alert('×”×›× ×¡ ×¡×›×•×');
      
      const e = {
        id: editingItem ? editingItem.id : Math.max(0, ...expenses.map(x => x.id)) + 1,
        date: document.getElementById('expDate').value,
        category: document.getElementById('expCategory').value,
        amount,
        description: document.getElementById('expDesc').value
      };

      if (editingItem) {
        const idx = expenses.findIndex(x => x.id === editingItem.id);
        expenses[idx] = e;
      } else {
        expenses.push(e);
      }
      save('vnb4_expenses', expenses);
      closeModal();
    }

    function deleteExpense() {
      if (!confirm('×œ××—×•×§?')) return;
      expenses = expenses.filter(e => e.id !== editingItem.id);
      save('vnb4_expenses', expenses);
      closeModal();
    }

    function saveProduct() {
      const name = document.getElementById('prodName').value.trim();
      if (!name) return alert('×”×›× ×¡ ×©×');
      
      const p = {
        id: editingItem ? editingItem.id : Math.max(0, ...products.map(x => x.id)) + 1,
        name,
        boxesPerCarton: parseInt(document.getElementById('prodBoxes').value) || 20,
        pricePerBox: parseFloat(document.getElementById('prodPrice').value) || 0,
        costPerBox: parseFloat(document.getElementById('prodCost').value) || 0,
        initialStock: parseInt(document.getElementById('prodStock').value) || 0,
        minStock: parseInt(document.getElementById('prodMin').value) || 5
      };

      if (editingItem) {
        const idx = products.findIndex(x => x.id === editingItem.id);
        products[idx] = p;
      } else {
        products.push(p);
      }
      save('vnb4_products', products);
      closeModal();
    }

    function deleteProduct() {
      if (!confirm('×œ××—×•×§?')) return;
      products = products.filter(p => p.id !== editingItem.id);
      save('vnb4_products', products);
      closeModal();
    }

    function exportData() {
      const data = { products, customers, sales, leads, expenses };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'vnb-backup.json';
      a.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (confirm('×œ×˜×¢×•×Ÿ ×’×™×‘×•×™? ×–×” ×™×—×œ×™×£ ××ª ×›×œ ×”× ×ª×•× ×™×')) {
            if (data.products) { products = data.products; save('vnb4_products', products); }
            if (data.customers) { customers = data.customers; save('vnb4_customers', customers); }
            if (data.sales) { sales = data.sales; save('vnb4_sales', sales); }
            if (data.leads) { leads = data.leads; save('vnb4_leads', leads); }
            if (data.expenses) { expenses = data.expenses; save('vnb4_expenses', expenses); }
            render();
            alert('× ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!');
          }
        } catch(err) {
          alert('×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥');
        }
      };
      reader.readAsText(file);
    }

    function resetData() {
      if (!confirm('×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™×?')) return;
      localStorage.clear();
      location.reload();
    }

    // Start
    render();
  </script>
</body>
</html>
